{"version":3,"sources":["appState.js","drawApi.js","screens/canvas/index.js","screens/canvas/CanvasPad.js","tools/toolpad_comp/PXSize.js","tools/toolpad_comp/DrawingTools.js","tools/toolpad_comp/ColorSwitcher.js","tools/ToolPad.js","tools/layerpad_comp/Player.js","tools/layerpad_comp/LayersList.js","tools/layerpad_comp/Layers.js","tools/layerpad_comp/LayerComposition.js","tools/layerpad_comp/Transform.js","tools/layerpad_comp/CanvasInfo.js","tools/LayerPad.js","tools/Menu.js","tools/ExportWindow.js","components/frames.list/index.js","components/frames.list/FramePad.js","components/Login.js","components/HeadPad.js","keyBind.js","Landing.js","tools/KeyBindWindow.js","App.js","index.js"],"names":["shortId","require","AppState","Object","classCallCheck","this","extendObservable","landing","size","scale","currentFrame","currentLayer","layers","pxSize","onionSkin","logIn","exportWindow","keyBindWindow","activeBindKey","target","tool","oldKey","compositeOperation","x","y","frames","addLayer","deleteLayerData","Frames","order","data","index","id","generate","Array","appState","fill","isArray","toConsumableArray","splice","push","indexOf","length","getCurrentData","up","currLayer","maxLayerLvl","next","_ref","startId","targetId","idx1","idx2","PlayerState","fps","timer","frameIdx","playerCnv","document","querySelector","clearInterval","setInterval","animate","bind","cnv","imgData","ctx","getContext","clearRect","width","height","globalCompositeOperation","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","layer","value","img","imagedataToImage","drawImage","err","return","imagedata","canvas","createElement","putImageData","image","Image","src","toDataURL","encoder","Encoder","name","backgroundColor","format","JSON","stringify","toJS","Blob","type","textFile","window","URL","createObjectURL","link","setAttribute","concat","click","imageSmoothingEnabled","framesArr","i","fillStyle","fillRect","getData","uintarr","getImageData","buffer","delay","delayMap","apng","UPNG","encode","console","log","createLink","Uint8Array","gif","GIFEncoder","setDelay","start","addFrame","finish","out","b64encoded","btoa","String","fromCharCode","apply","datajpg","hex","replace","m","r","g","b","substring","match","map","parseInt","join","playerState","drawApi","selectedTool","primaryColor","secondaryColor","toolSwitcher","e","pencil","eraser","smoothPencil","bucket","pickColor","sameColorPixel","drawLine","drawCircle","drawRectangle","move","dither","lighter","calcMousePos","nativeEvent","pixelX","offsetX","pixelY","offsetY","setCtxStyle","temp","which","strokeStyle","getColor","position","_drawApi","parentNode","color","rgbToHex","toString","destroy","onmousemove","onmouseup","updateCurrentFrame","drawFill","preventDefault","mouse","clearFill","drawMirrorFill","mirror","currentTarget","beginPath","lineWidth","moveTo","lineTo","stroke","startColor","stack","pop","col","row","endPos","startPos","drawCtx","drawCtxData","end","radiusX","radiusY","Math","abs","ellipse","PI","strokeRect","changeLight","ammount","ditherDraw","rotate","save","translate","restore","drawData","vertical","observable","CanvasPad","observer","_React$Component","props","_this","possibleConstructorReturn","getPrototypeOf","call","canvasPad","React","createRef","belowCnv","drawCnv","aboveCnv","glowCnv","cnvArr","handleWheel","assertThisInitialized","updateCnvArrScale","inherits","createClass","key","_this2","slice","curLayer","react_default","a","className","ref","onContextMenu","handleBelowCanvasRender","style","opacity","handleDrawCanvasRender","handleAboveCanvasRender","onMouseDown","current","querySelectorAll","addEventListener","box","offsetHeight","offsetWidth","side","trunc","forEach","transform","ctrlKey","deltaY","Component","PXSize","arguments","data-size","onClick","handleClick","dataset","DrawingTools","ColorSwitcher","background","onInput","handleColor","handleColorSwitch","ToolPad","toolpad_comp_PXSize","toolpad_comp_DrawingTools","toolpad_comp_ColorSwitcher","Player","min","max","LayersList","data-layer","random","reverse","Layers","layerpad_comp_LayersList","deleteCurrentLayer","moveLayer","LayerComposition","onChange","handleInput","operator","Transform","CanvasInfo","LayerPad","layerpad_comp_Player","layerpad_comp_Layers","layerpad_comp_LayerComposition","layerpad_comp_Transform","layerpad_comp_CanvasInfo","Menu","handleChangeSize","handleExport","ExportWindow","handleClose","onSubmit","handleSubmit","htmlFor","handleNameChange","handleFormatChange","handleFPSChange","step","handleSizeChange","handleBackgroundColorChange","handleCloseWindow","exportGif","exportPSK","exportAPNG","classList","contains","FramePad","number","draggable","handleFrameDiv","data-idx","handleCanvasRender","handleAddFrame","dropZone","ondragstart","event","getAttribute","ondragenter","parentElement","add","ondragleave","remove","ondragover","ondrop","div","closest","switchFrames","frame","deleteFrame","responseGoogle","response","user","surname","imageUrl","Login","google_login","render","renderProps","disabled","buttonText","onLogoutSuccess","alt","clientId","onSuccess","resp","profileObj","givenName","familyName","onFailure","cookiePolicy","HeadPad","components_Login","keyBind","KeyBind","pen","mirrorPen","paintBucket","circle","rectangle","lightenDarken","colorPicker","smoothPen","Landing","Fragment","KeyBindWindow","handleClosingClick","handleBindClick","data-key","data-tool","onkeypress","stopPropagation","code","newKey","toUpperCase","App","src_Landing","src_components_HeadPad","tools_ToolPad","frames_list","screens_canvas","src_tools_LayerPad","src_tools_Menu","src_tools_ExportWindow","src_tools_KeyBindWindow","keySwitcher","ReactDOM","src_App","getElementById"],"mappings":"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","file":"static/js/main.32809f26.chunk.js","sourcesContent":["import { toJS } from 'mobx';\nimport UPNG from 'upng-js';\nimport { extendObservable } from 'mobx';\nimport GIFEncoder from 'gif-encoder-2';\nconst shortId = require('shortid');\n\nclass AppState {\n  constructor() {\n    extendObservable(this, {\n      landing: true,\n      size: 32,\n      scale: 20,\n      currentFrame: 0,\n      currentLayer: 0,\n      layers: 1,\n      pxSize: 1,\n      onionSkin: true,\n      logIn: false,\n      exportWindow: false,\n      keyBindWindow: false,\n      activeBindKey: { target: null, tool: null, oldKey: null },\n      compositeOperation: 'source-over',\n      x: 0,\n      y: 0,\n    });\n  }\n\n  addLayer() {\n    this.layers++;\n    this.currentLayer++;\n    frames.addLayer();\n  }\n\n  deleteCurrentLayer() {\n    frames.deleteLayerData();\n    if (this.layers > 1) this.layers--;\n    if (this.currentLayer > 0) {\n      this.currentLayer--;\n    }\n  }\n}\n\nclass Frames {\n  constructor() {\n    extendObservable(this, {\n      order: [],\n      data: {},\n    });\n    //[ID фреймов упорядоченные по кадрам]\n    //{ ID фрейма: массив ImageData объектов согласно Layer } \n  }\n\n  // data может быть как объектом, так и массивом объектов или null\n  // index передается для вставки элемента в центр массива\n  // если index не определен - в конец массива\n\n  addFrame(data, index) {\n    const id = shortId.generate();\n    if (!data) data = Array(appState.layers).fill(null);\n    data = Array.isArray(data) ? [...data] : [data];\n\n    this.data[id] = data;\n    index ? this.order.splice(index, 0, id) : this.order.push(id);\n\n    appState.currentFrame = this.order.indexOf(id);\n    return id;\n  }\n\n  deleteFrame(id) {\n    if (this.order.length === 1) {\n      const id = this.order[0];\n      this.data[id] = [null];\n    } else {\n      const index = this.order.indexOf(id);\n      this.order.splice(index, 1);\n      delete this.data[id];\n    }\n    appState.currentFrame = 0;\n  }\n\n  updateCurrentFrame(data) {\n    const frame = this.getCurrentData();\n    frame[appState.currentLayer] = data;\n  }\n\n  getCurrentData() {\n    const id = this.order[appState.currentFrame];\n    return this.data[id];\n  }\n\n  getData(id) {\n    return this.data[id];\n  }\n\n  addLayer() {\n    for (let data in frames.data) {\n      const layers = this.data[data];\n      if (appState.layers > layers.length) layers.push(null);\n    }\n  }\n\n  moveLayer(up) {\n    const currLayer = appState.currentLayer;\n    const maxLayerLvl = appState.layers - 1;\n    if (up && currLayer === maxLayerLvl) return;\n    if (!up && currLayer === 0) return;\n    for (let data in this.data) {\n      const layers = this.data[data];\n      const next = up ? currLayer + 1 : currLayer - 1;\n      [layers[currLayer], layers[next]] = [layers[next], layers[currLayer]];\n    }\n    up ? appState.currentLayer++ : appState.currentLayer--;\n  }\n\n  deleteLayerData() {\n    for (let data in this.data) {\n      const layers = this.data[data];\n      layers.splice(appState.currentLayer, 1);\n    }\n  }\n\n  switchFrames(startId, targetId) {\n    if (startId === targetId) return;\n    const idx1 = this.order.indexOf(startId);\n    const idx2 = this.order.indexOf(targetId);\n    this.order[idx1] = targetId;\n    this.order[idx2] = startId;\n\n  }\n};\n\nclass PlayerState {\n  constructor() {\n    extendObservable(this, {\n      fps: 24,\n      timer: null,\n      frameIdx: 0,\n    });\n  }\n\n  start() {\n    const playerCnv = document.querySelector('.player-canvas');\n    clearInterval(this.timer);\n    this.timer = setInterval(this.animate.bind(this, playerCnv), 1000 / this.fps)\n  }\n\n  animate(cnv) {\n    if (this.frameIdx >= frames.order.length) this.frameIdx = 0;\n    let id = frames.order[this.frameIdx];\n\n    const imgData = frames.data[id];\n    const ctx = cnv.getContext('2d');\n    ctx.clearRect(0, 0, cnv.width, cnv.height);\n    ctx.globalCompositeOperation = appState.compositeOperation;\n\n    for (let layer of imgData) {\n      if (layer == null) continue;\n      const img = this.imagedataToImage(layer);\n      ctx.drawImage(img, 0, 0);\n    }\n    this.frameIdx++;\n  }\n\n  imagedataToImage(imagedata) {\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n    canvas.width = imagedata.width;\n    canvas.height = imagedata.height;\n    ctx.putImageData(imagedata, 0, 0);\n\n    var image = new Image();\n    image.src = canvas.toDataURL();\n    return image;\n  }\n}\n\nclass Encoder {\n  constructor() {\n    extendObservable(this, {\n      fps: 24,\n      name: 'new',\n      backgroundColor: null,\n      format: 'gif',\n      size: 32,\n    });\n  }\n\n  async exportPSK() {\n    const img = JSON.stringify(toJS(frames));\n    const data = new Blob([img], { type: 'text/plain' });\n    const textFile = window.URL.createObjectURL(data);\n\n    const link = document.createElement('a');\n    link.setAttribute('href', textFile);\n    link.setAttribute('download', `${this.name}.${this.format}`);\n    link.click();\n  }\n\n  async exportAPNG() {\n    const cnv = document.createElement('canvas');\n    const size = this.size;\n    cnv.width = size;\n    cnv.height = size;\n    const ctx = cnv.getContext('2d');\n    ctx.imageSmoothingEnabled = false;\n    ctx.globalCompositeOperation = appState.compositeOperation;\n\n    const framesArr = [];\n\n    for (let i = 0; i < frames.order.length; i++) {\n      if (this.backgroundColor) {\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fillRect(0, 0, size, size);\n      }\n\n      const id = frames.order[i];\n      const data = frames.getData(id);\n\n      for (let layer of data) {\n        if (!layer) continue;\n        const img = this.imagedataToImage(layer);\n        ctx.drawImage(img, 0, 0, size, size);\n      }\n\n      const uintarr = ctx.getImageData(0, 0, size, size).data;\n\n      framesArr.push(uintarr.buffer);\n      ctx.clearRect(0, 0, size, size);\n    }\n\n    const delay = 1000 / this.fps;\n    const delayMap =  Array(framesArr.length).fill(delay);\n\n    \n    const apng = UPNG.encode(framesArr, this.size, this.size, 0, delayMap);\n\n    console.log('raw', apng);\n    const link = this.createLink(new Uint8Array(apng), this.name);\n    link.click();\n  }\n\n  async exportGif() {\n    const cnv = document.createElement('canvas');\n    const size = this.size;\n    cnv.width = size;\n    cnv.height = size;\n    const ctx = cnv.getContext('2d');\n    ctx.imageSmoothingEnabled = false;\n    ctx.globalCompositeOperation = appState.compositeOperation;\n    const gif = new GIFEncoder(size, size);\n\n    gif.setDelay(1000 / this.fps);\n    gif.start();\n    for (let i = 0; i < frames.order.length; i++) {\n      if (this.backgroundColor) {\n        ctx.fillStyle = this.backgroundColor;\n        ctx.fillRect(0, 0, size, size);\n      }\n\n      const id = frames.order[i];\n      const data = frames.getData(id);\n\n      for (let layer of data) {\n        if (!layer) continue;\n        const img = this.imagedataToImage(layer);\n        ctx.drawImage(img, 0, 0, size, size);\n      }\n\n      gif.addFrame(ctx);\n      ctx.clearRect(0, 0, size, size);\n    }\n\n    gif.finish();\n    const buffer = gif.out.getData();\n    console.log(buffer);\n    const link = this.createLink(buffer);\n    link.click();\n  }\n\n  createLink(buffer) {\n    const b64encoded = btoa(String.fromCharCode.apply(null, buffer));\n    const datajpg = `data:image/jpg;base64,${b64encoded}`;\n\n    const link = document.createElement('a');\n    link.setAttribute('href', datajpg);\n    link.setAttribute('download', `${this.name}.${this.format}`);\n\n    return link;\n  }\n\n  hexToRgb(hex) {\n    console.log(hex);\n    hex.replace(/^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i, (m, r, g, b) => `#${r}${r}${g}${g}${b}${b}`)\n      .substring(1).match(/.{2}/g)\n      .map(x => parseInt(x, 16))\n      .join();\n    console.log(hex);\n    return hex;\n  }\n\n  imagedataToImage(imagedata) {\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n    canvas.width = imagedata.width;\n    canvas.height = imagedata.height;\n    ctx.putImageData(imagedata, 0, 0);\n\n    var image = new Image();\n    image.src = canvas.toDataURL();\n    return image;\n  }\n}\n\nconst encoder = new Encoder();\n\nconst frames = new Frames();\n\nconst appState = new AppState();\n\nconst playerState = new PlayerState();\n\nexport { appState, frames, playerState, encoder };\n","import { observable } from 'mobx';\r\nimport { appState, frames, playerState } from './appState';\r\n\r\nlet drawApi = {\r\n  pxSize: 1,\r\n  selectedTool: 'pen',\r\n  primaryColor: '#00ffff',\r\n  secondaryColor: '#ff00ff',\r\n\r\n  toolSwitcher(e) {\r\n\r\n    switch (drawApi.selectedTool) {\r\n      case 'pen':\r\n        drawApi.pencil(e, false);\r\n        break;\r\n\r\n      case 'mirror-pen':\r\n        drawApi.pencil(e, true);\r\n        break;\r\n\r\n      case 'eraser':\r\n        drawApi.eraser(e);\r\n        break;\r\n\r\n      case 'smooth-pen':\r\n        drawApi.smoothPencil(e);\r\n        break;\r\n\r\n      case 'paint-bucket':\r\n        drawApi.bucket(e);\r\n        break;\r\n\r\n      case 'color-picker':\r\n        drawApi.pickColor(e);\r\n        break;\r\n\r\n      case 'same-color-pixel':\r\n        drawApi.sameColorPixel(e);\r\n        break;\r\n\r\n      case 'stroke':\r\n        drawApi.drawLine(e);\r\n        break;\r\n\r\n      case 'circle':\r\n        drawApi.drawCircle(e);\r\n        break;\r\n\r\n      case 'rectangle':\r\n        drawApi.drawRectangle(e);\r\n        break;\r\n\r\n      case 'move':\r\n        drawApi.move(e);\r\n        break;\r\n\r\n      case 'dither':\r\n        drawApi.dither(e);\r\n        break;\r\n\r\n      case 'lighten-darken':\r\n        drawApi.lighter(e);\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  calcMousePos(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n    const pixelX = e.offsetX;\r\n    const pixelY = e.offsetY;\r\n    console.log(pixelX, pixelY);\r\n    return { x: pixelX, y: pixelY };\r\n  },\r\n\r\n  setCtxStyle(e, ctx, fill) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n    let temp;\r\n\r\n    if (e.which === 1) {\r\n      temp = drawApi.primaryColor;\r\n    } else if (e.which === 3) {\r\n      temp = drawApi.secondaryColor;\r\n    } else return false;\r\n\r\n    if (fill) {\r\n      ctx.fillStyle = temp;\r\n    } else {\r\n      ctx.strokeStyle = temp;\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  getColor(e, position) {\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    if (!position) position = { x: e.offsetX, y: e.offsetY }\r\n\r\n    const color = ctx.getImageData(position.x, position.y, 1, 1);\r\n\r\n    return drawApi.rgbToHex(...color.data);\r\n  },\r\n\r\n  rgbToHex(r, g, b) {\r\n    r = r.toString(16);\r\n    g = g.toString(16);\r\n    b = b.toString(16);\r\n\r\n    if (r.length === 1) r = '0' + r;\r\n    if (g.length === 1) g = '0' + g;\r\n    if (b.length === 1) b = '0' + b;\r\n\r\n    return `#${(r + g + b)}`;\r\n  },\r\n\r\n  destroy(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n    document.querySelector('.pixel-glow-canvas').onmousemove = null;\r\n    window.onmouseup = null;\r\n    const data = ctx.getImageData(0, 0, appState.size, appState.size);\r\n    frames.updateCurrentFrame(data);\r\n  },\r\n\r\n  imagedataToImage(imagedata) {\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    canvas.width = imagedata.width;\r\n    canvas.height = imagedata.height;\r\n    ctx.putImageData(imagedata, 0, 0);\r\n\r\n    const image = new Image();\r\n    image.src = canvas.toDataURL();\r\n    return image;\r\n  },\r\n\r\n  drawFill(e) {\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n    e.preventDefault();\r\n\r\n    if (!drawApi.setCtxStyle(e, ctx, true)) return false;\r\n\r\n    let mouse = drawApi.calcMousePos(e);\r\n\r\n    if (drawApi.pxSize > 2) {\r\n      ctx.fillRect(mouse.x - 2, mouse.y - 2, drawApi.pxSize, drawApi.pxSize)\r\n    } else {\r\n      ctx.fillRect(mouse.x, mouse.y - 1, drawApi.pxSize, drawApi.pxSize);\r\n    }\r\n  },\r\n\r\n  clearFill(e) {\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    let mouse = drawApi.calcMousePos(e);\r\n\r\n    if (drawApi.pxSize > 2) {\r\n      ctx.clearRect(mouse.x - 2, mouse.y - 2, drawApi.pxSize, drawApi.pxSize)\r\n    } else {\r\n      ctx.clearRect(mouse.x, mouse.y - 1, drawApi.pxSize, drawApi.pxSize);\r\n    }\r\n  },\r\n\r\n  drawMirrorFill(e) {\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n    e.preventDefault();\r\n\r\n    if (!drawApi.setCtxStyle(e, ctx, true)) return false;\r\n\r\n    let mouse = drawApi.calcMousePos(e);\r\n\r\n    if (drawApi.pxSize > 2) {\r\n      ctx.fillRect(mouse.x - 2, mouse.y - 2, drawApi.pxSize, drawApi.pxSize);\r\n      ctx.fillRect(appState.size - mouse.x - 1, mouse.y - 2, drawApi.pxSize, drawApi.pxSize)\r\n    } else {\r\n      ctx.fillRect(mouse.x - 1, mouse.y - 1, drawApi.pxSize, drawApi.pxSize);\r\n      ctx.fillRect(appState.size - mouse.x, mouse.y - 1, drawApi.pxSize, drawApi.pxSize);\r\n    }\r\n  },\r\n\r\n  pencil(e, mirror) {\r\n    e.preventDefault();\r\n\r\n    mirror ? drawApi.drawMirrorFill(e) : drawApi.drawFill(e);\r\n\r\n    e.currentTarget.onmousemove = mirror ? drawApi.drawMirrorFill : drawApi.drawFill;\r\n\r\n    window.onmouseup = drawApi.destroy;\r\n  },\r\n\r\n  smoothPencil(e) {\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n    e.preventDefault();\r\n\r\n    ctx.beginPath();\r\n    if (!drawApi.setCtxStyle(e, ctx, false)) return false;\r\n\r\n    ctx.lineWidth = drawApi.pxSize;\r\n    ctx.moveTo(e.offsetX, e.offsetY);\r\n    ctx.lineTo(e.offsetX, e.offsetY);\r\n    ctx.stroke();\r\n\r\n    e.currentTarget.onmousemove = e => {\r\n      ctx.lineTo(e.offsetX, e.offsetY);\r\n      ctx.stroke();\r\n    };\r\n\r\n    window.onmouseup = drawApi.destroy;\r\n  },\r\n\r\n  eraser(e) {\r\n    e.preventDefault();\r\n\r\n    drawApi.clearFill(e);\r\n\r\n    e.currentTarget.onmousemove = drawApi.clearFill;\r\n\r\n    window.onmouseup = drawApi.destroy;\r\n  },\r\n\r\n  bucket(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    if (!drawApi.setCtxStyle(e, ctx, true)) return false;\r\n\r\n    const mouse = drawApi.calcMousePos(e);\r\n    const curFrame = frames.getCurrentData();\r\n\r\n    if (!curFrame[appState.currentLayer]) {\r\n      ctx.fillRect(0, 0, appState.size, appState.size);\r\n    } else {\r\n      const startColor = drawApi.getColor(e, mouse);\r\n\r\n      if (startColor === ctx.fillStyle) return;\r\n\r\n      const stack = [mouse];\r\n\r\n      while (stack.length) {\r\n        const position = stack.pop();\r\n        const x = position.x;\r\n        const y = position.y;\r\n\r\n        if ((x >= 0 && x < appState.size) && (y >= 0 && y < appState.size)) {\r\n          const currentColor = drawApi.getColor(e, position);\r\n          if (startColor === currentColor) {\r\n            ctx.fillRect(x, y, 1, 1);\r\n            stack.push({ x: x - 1, y: y }, { x: x + 1, y: y }, { x: x, y: y - 1 }, { x: x, y: y + 1 });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const data = ctx.getImageData(0, 0, appState.size, appState.size);\r\n    frames.updateCurrentFrame(data);\r\n  },\r\n\r\n  sameColorPixel(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    if (!drawApi.setCtxStyle(e, ctx, true)) return false;\r\n\r\n    const mouse = drawApi.calcMousePos(e);\r\n    const curFrame = frames.getCurrentData();\r\n\r\n    if (!curFrame[appState.currentLayer]) {\r\n      ctx.fillRect(0, 0, appState.size, appState.size);\r\n    } else {\r\n      const startColor = drawApi.getColor(e, mouse);\r\n\r\n      if (startColor === ctx.fillStyle) return;\r\n\r\n      for (let col = 0; col < appState.size; col++) {\r\n        for (let row = 0; row < appState.size; row++) {\r\n          const color = drawApi.getColor(e, { x: row, y: col });\r\n          if (startColor === color) {\r\n            ctx.fillRect(row, col, 1, 1);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const data = ctx.getImageData(0, 0, appState.size, appState.size);\r\n    frames.updateCurrentFrame(data);\r\n  },\r\n\r\n  pickColor(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n\r\n    const color = drawApi.getColor(e);\r\n\r\n    if (e.which === 1) {\r\n      drawApi.primaryColor = color;\r\n    } else if (e.which === 3) {\r\n      drawApi.secondaryColor = color;\r\n    } else return;\r\n  },\r\n\r\n  drawLine(e) {\r\n    const cnv = e.currentTarget;\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    const startPos = drawApi.calcMousePos(e);\r\n    let endPos;\r\n\r\n    if (!drawApi.setCtxStyle(e, ctx, false)) return false;\r\n    ctx.lineWidth = drawApi.pxSize;\r\n\r\n    cnv.onmousemove = (e) => {\r\n      ctx.clearRect(0, 0, appState.size, appState.size);\r\n      ctx.beginPath();\r\n      ctx.moveTo(startPos.x, startPos.y);\r\n\r\n      endPos = drawApi.calcMousePos(e);\r\n      ctx.lineTo(endPos.x, endPos.y);\r\n      ctx.stroke();\r\n    }\r\n\r\n    window.onmouseup = (e) => {\r\n      cnv.onmousemove = null;\r\n      window.onmouseup = null;\r\n\r\n      ctx.clearRect(0, 0, appState.size, appState.size);\r\n\r\n      const drawCnv = e.target.parentNode.querySelector('.draw-canvas');\r\n      const drawCtx = drawCnv.getContext('2d');\r\n      if (!drawApi.setCtxStyle(e, drawCtx, false)) return false;\r\n      drawCtx.lineWidth = drawApi.pxSize;\r\n\r\n      drawCtx.beginPath();\r\n      drawCtx.moveTo(startPos.x, startPos.y);\r\n\r\n      drawCtx.lineTo(endPos.x, endPos.y);\r\n      drawCtx.stroke();\r\n\r\n      const drawCtxData = drawCtx.getImageData(0, 0, appState.size, appState.size);\r\n      frames.updateCurrentFrame(drawCtxData);\r\n    }\r\n  },\r\n\r\n  drawCircle(e) {\r\n    const cnv = e.currentTarget;\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    const startPos = drawApi.calcMousePos(e);\r\n    const x = startPos.x;\r\n    const y = startPos.y;\r\n    let end;\r\n    let radiusX;\r\n    let radiusY;\r\n\r\n    if (!drawApi.setCtxStyle(e, ctx, false)) return false;\r\n    ctx.lineWidth = drawApi.pxSize;\r\n\r\n    cnv.onmousemove = (e) => {\r\n      ctx.clearRect(0, 0, appState.size, appState.size);\r\n      end = drawApi.calcMousePos(e);\r\n\r\n      radiusX = Math.abs(end.x - x);\r\n      radiusY = Math.abs(end.y - y)\r\n\r\n      ctx.beginPath();\r\n      ctx.ellipse(x, y, radiusX, radiusY, 0, 0, 2 * Math.PI);\r\n\r\n      ctx.stroke();\r\n    }\r\n\r\n    window.onmouseup = (e) => {\r\n      cnv.onmousemove = null;\r\n      window.onmouseup = null;\r\n\r\n      ctx.clearRect(0, 0, appState.size, appState.size);\r\n\r\n      const drawCnv = e.target.parentNode.querySelector('.draw-canvas');\r\n      const drawCtx = drawCnv.getContext('2d');\r\n      if (!drawApi.setCtxStyle(e, drawCtx, false)) return false;\r\n      drawCtx.lineWidth = drawApi.pxSize;\r\n\r\n      drawCtx.beginPath();\r\n      for (let i = 0; i < 3; i++) {\r\n        drawCtx.ellipse(x, y, radiusX, radiusY, 0, 0, 2 * Math.PI);\r\n      }\r\n      drawCtx.stroke();\r\n\r\n      const drawCtxData = drawCtx.getImageData(0, 0, appState.size, appState.size);\r\n      frames.updateCurrentFrame(drawCtxData);\r\n    }\r\n  },\r\n\r\n  drawRectangle(e) {\r\n    const cnv = e.currentTarget;\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    const startPos = drawApi.calcMousePos(e);\r\n    const x = startPos.x;\r\n    const y = startPos.y;\r\n    let end;\r\n\r\n    if (!drawApi.setCtxStyle(e, ctx, false)) return false;\r\n    ctx.lineWidth = drawApi.pxSize;\r\n\r\n    cnv.onmousemove = (e) => {\r\n      ctx.clearRect(0, 0, appState.size, appState.size);\r\n      end = drawApi.calcMousePos(e);\r\n\r\n      ctx.beginPath();\r\n      ctx.strokeRect(x, y, end.x - x, end.y - y);\r\n    }\r\n\r\n    window.onmouseup = (e) => {\r\n      cnv.onmousemove = null;\r\n      window.onmouseup = null;\r\n\r\n      ctx.clearRect(0, 0, appState.size, appState.size);\r\n\r\n      const drawCnv = e.target.parentNode.querySelector('.draw-canvas');\r\n      const drawCtx = drawCnv.getContext('2d');\r\n      if (!drawApi.setCtxStyle(e, drawCtx, false)) return false;\r\n      drawCtx.lineWidth = drawApi.pxSize;\r\n\r\n      drawCtx.beginPath();\r\n      for (let i = 0; i < 3; i++) {\r\n        drawCtx.strokeRect(x, y, end.x - x, end.y - y);\r\n      }\r\n\r\n      const drawCtxData = drawCtx.getImageData(0, 0, appState.size, appState.size);\r\n      frames.updateCurrentFrame(drawCtxData);\r\n    }\r\n  },\r\n\r\n  move(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n\r\n    const drawCnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const drawCtx = drawCnv.getContext('2d');\r\n\r\n    const data = drawCtx.getImageData(0, 0, appState.size, appState.size);\r\n    const start = drawApi.calcMousePos(e);\r\n    let end;\r\n\r\n    e.target.onmousemove = (e) => {\r\n      drawCtx.clearRect(0, 0, appState.size, appState.size);\r\n      end = drawApi.calcMousePos(e);\r\n      drawCtx.putImageData(data, end.x - start.x, end.y - start.y);\r\n    }\r\n\r\n    window.onmouseup = drawApi.destroy;\r\n  },\r\n\r\n  lighter(e) {\r\n\r\n    drawApi.changeLight(e);\r\n\r\n    e.currentTarget.onmousemove = drawApi.changeLight;\r\n\r\n    window.onmouseup = drawApi.destroy;\r\n  },\r\n\r\n  changeLight(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    const mouse = drawApi.calcMousePos(e);\r\n    let x;\r\n    let y;\r\n    if (drawApi.pxSize > 2) {\r\n      x = mouse.x - 2;\r\n      y = mouse.y - 2;\r\n    } else {\r\n      x = mouse.x;\r\n      y = mouse.y - 1;\r\n    }\r\n\r\n    const layer = ctx.getImageData(x, y, drawApi.pxSize, drawApi.pxSize);\r\n    const data = layer.data;\r\n    let ammount;\r\n\r\n    if (e.which === 1) {\r\n      ammount = 2;\r\n    } else if (e.which === 3) {\r\n      ammount = -2;\r\n    } else return false;\r\n\r\n    for (let i = 0; i < layer.data.length; i += 4) {\r\n      data[i] += ammount;\r\n      data[i + 1] += ammount;\r\n      data[i + 2] += ammount;\r\n    }\r\n\r\n    ctx.putImageData(layer, x, y);\r\n  },\r\n\r\n  dither(e) {\r\n    drawApi.ditherDraw(e);\r\n\r\n    e.currentTarget.onmousemove = drawApi.ditherDraw;\r\n\r\n    window.onmouseup = drawApi.destroy;\r\n  },\r\n\r\n  ditherDraw(e) {\r\n    if (e.nativeEvent) e = e.nativeEvent;\r\n    const cnv = e.target.parentNode.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    const mouse = drawApi.calcMousePos(e);\r\n    \r\n    drawApi.setCtxStyle(e, ctx, true);\r\n\r\n    if((mouse.x + mouse.y) % 2) {\r\n      ctx.fillRect(mouse.x, mouse.y, 1, 1);\r\n    } else {\r\n      ctx.clearRect(mouse.x, mouse.y, 1, 1);\r\n    }\r\n  },\r\n\r\n  rotate() {\r\n    const cnv = document.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n  \r\n    const length = appState.size / 2;\r\n    ctx.save();\r\n    ctx.translate(length, length); // translate to rectangle center \r\n    ctx.rotate(Math.PI * 3 / 2); // rotate\r\n    ctx.translate(-length, -length);\r\n\r\n    const data = frames.getCurrentData();\r\n\r\n    const img = playerState.imagedataToImage(data[appState.currentLayer]);\r\n    ctx.clearRect(0, 0, appState.size, appState.size);\r\n    ctx.drawImage(img, 0, 0);\r\n\r\n    ctx.restore();\r\n    const drawData = ctx.getImageData(0, 0, appState.size, appState.size);\r\n    frames.updateCurrentFrame(drawData);\r\n  },\r\n\r\n  mirror(vertical) {\r\n    const cnv = document.querySelector('.draw-canvas');\r\n    const ctx = cnv.getContext('2d');\r\n\r\n    ctx.save();\r\n\r\n    vertical ? ctx.translate(appState.size, 0) : ctx.translate(0, appState.size); \r\n    vertical ? ctx.scale(-1, 1) : ctx.scale(1, -1);\r\n\r\n    const data = frames.getCurrentData();\r\n\r\n    const img = playerState.imagedataToImage(data[appState.currentLayer]);\r\n    ctx.clearRect(0, 0, appState.size, appState.size);\r\n    ctx.drawImage(img, 0, 0);\r\n\r\n    ctx.restore();\r\n    const drawData = ctx.getImageData(0, 0, appState.size, appState.size);\r\n    frames.updateCurrentFrame(drawData);\r\n  },\r\n}\r\n\r\ndrawApi = observable(drawApi);\r\n\r\nexport default drawApi;\r\n","import CanvasPad from './CanvasPad';\r\n\r\nexport default CanvasPad;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState, frames } from '../../appState';\r\nimport drawApi from '../../drawApi';\r\n\r\nconst CanvasPad = observer(\r\n  class CanvasPad extends React.Component {\r\n    constructor(props) {\r\n      super(props);\r\n      this.canvasPad = React.createRef();\r\n      this.belowCnv = null;\r\n      this.drawCnv = null;\r\n      this.aboveCnv = null;\r\n      this.glowCnv = null;\r\n      this.cnvArr = null;\r\n\r\n      this.handleWheel = this.handleWheel.bind(this);\r\n      this.updateCnvArrScale = this.updateCnvArrScale.bind(this);\r\n    }\r\n\r\n    render() {\r\n      console.log(appState.size,\r\n        appState.currentLayer,\r\n        appState.currentFrame,\r\n        JSON.stringify(frames.data).slice(0, 0));\r\n      this.updateCnvArrScale();\r\n      const curLayer = appState.currentLayer;\r\n      const curFrame = appState.currentFrame;\r\n      return (\r\n        <div\r\n          className=\"canvas-pad\"\r\n          ref={this.canvasPad}\r\n          onContextMenu={e => e.preventDefault()}\r\n        >\r\n          <canvas\r\n            className=\"background-canvas\"\r\n            width={appState.size}\r\n            height={appState.size}\r\n          >\r\n          </canvas>\r\n          <canvas\r\n            className=\"layers-below-canvas\"\r\n            width={appState.size}\r\n            height={appState.size}\r\n            ref={(cnv) => {\r\n              this.belowCnv = cnv;\r\n              this.handleBelowCanvasRender(cnv, curLayer);\r\n            }}\r\n            style={{opacity: appState.onionSkin ? 0.4 : 0}}\r\n          >\r\n          </canvas>\r\n          <canvas\r\n            width={appState.size}\r\n            height={appState.size}\r\n            className='draw-canvas'\r\n            ref={(cnv) => {\r\n              this.drawCnv = cnv;\r\n              this.handleDrawCanvasRender(cnv, curLayer);\r\n            }}\r\n          >\r\n          </canvas>\r\n          <canvas\r\n            className=\"layers-above-canvas\"\r\n            width={appState.size}\r\n            height={appState.size}\r\n            ref={(cnv) => {\r\n              this.aboveCnv = cnv;\r\n              this.handleAboveCanvasRender(cnv, curLayer);\r\n            }}\r\n            style={{opacity: appState.onionSkin ? 0.4 : 0 }}\r\n          >\r\n          </canvas>\r\n          <canvas\r\n            className=\"pixel-glow-canvas\"\r\n            width={appState.size}\r\n            height={appState.size}\r\n            onMouseDown={drawApi.toolSwitcher}\r\n            ref={(cnv) => { this.glowCnv = cnv; }}\r\n          >\r\n          </canvas>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    handleBelowCanvasRender(cnv, currentLayer) {\r\n      if (!cnv) return;\r\n      const ctx = cnv.getContext('2d');\r\n      ctx.globalCompositeOperation = 'source-over';\r\n      ctx.clearRect(0, 0, cnv.width, cnv.height);\r\n      const data = frames.getCurrentData();\r\n      for(let i = 0; i < currentLayer; i++) { \r\n        if (!data[i]) continue;\r\n        const img = drawApi.imagedataToImage(data[i]);\r\n        ctx.drawImage(img, 0, 0);\r\n      }\r\n    }\r\n\r\n    handleDrawCanvasRender(cnv, currentLayer) {\r\n      if (!cnv) return;\r\n      const ctx = cnv.getContext('2d');\r\n      ctx.clearRect(0, 0, cnv.width, cnv.height);\r\n      const data = frames.getCurrentData();\r\n      const curLayer = data[currentLayer];\r\n      if(!curLayer) return;\r\n      ctx.putImageData(curLayer, 0, 0);\r\n    }\r\n\r\n    handleAboveCanvasRender(cnv, currentLayer) {\r\n      if (!cnv) return;\r\n      const ctx = cnv.getContext('2d');\r\n      ctx.globalCompositeOperation = 'source-over';\r\n      ctx.clearRect(0, 0, cnv.width, cnv.height);\r\n      const data = frames.getCurrentData();\r\n      for(let i = currentLayer + 1; i < data.length; i++) { \r\n        if (!data[i]) continue;\r\n        const img = drawApi.imagedataToImage(data[i]);\r\n        ctx.drawImage(img, 0, 0);\r\n      }\r\n    }\r\n\r\n    componentDidMount() {\r\n      this.cnvArr = this.canvasPad.current.querySelectorAll('canvas');\r\n      this.updateCnvArrScale();\r\n      this.canvasPad.current.addEventListener('wheel', this.handleWheel, false);\r\n      this.glowCnv.addEventListener('mousemove', (e) => {\r\n        appState.x = e.offsetX;\r\n        appState.y = e.offsetY;\r\n      })\r\n    }\r\n\r\n    updateCnvArrScale() {\r\n      if (!this.drawCnv) return;\r\n\r\n      let box = this.canvasPad.current;\r\n\r\n      if (appState.scale <= 1) {\r\n        appState.scale = 1;\r\n      }\r\n\r\n      if (appState.scale * appState.size > box.offsetHeight\r\n        || appState.scale * appState.size > box.offsetWidth) {\r\n        const side = box.offsetHeight >= box.offsetWidth\r\n          ? box.offsetWidth\r\n          : box.offsetHeight;\r\n        appState.scale = Math.trunc(side / appState.size);\r\n      }\r\n\r\n      this.cnvArr.forEach(cnv => {\r\n        cnv.style.transform = 'scale(' + appState.scale + ')';\r\n      });\r\n    }\r\n\r\n    handleWheel(e) {\r\n      if (e.ctrlKey) {\r\n        e.preventDefault();\r\n        appState.scale += e.deltaY > 0 ? -2 : 2;\r\n        this.updateCnvArrScale();\r\n      }\r\n    }\r\n  }\r\n);\r\n\r\nexport default CanvasPad;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState } from '../../appState';\r\nimport drawApi from '../../drawApi';\r\n\r\nconst PXSize = observer(\r\n  class PXSize extends React.Component {\r\n    \r\n    render() {\r\n      return (\r\n        <div \r\n          className=\"pixel-size\"\r\n        >\r\n          {[1, 2, 3, 4].map(size => \r\n              <div \r\n                data-size={size} \r\n                className={size === drawApi.pxSize ? 'selected' : ''}\r\n                onClick={this.handleClick}\r\n                key={size}\r\n              >\r\n                <div className={'size-' + size}></div>\r\n              </div>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    handleClick(e) {\r\n      const target = e.currentTarget;\r\n      drawApi.pxSize = +target.dataset.size;\r\n    }\r\n  }\r\n);\r\n\r\nexport default PXSize;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport drawApi from '../../drawApi';\r\n\r\nconst DrawingTools = observer(\r\n  class DrawingTools extends React.Component {\r\n    render() {\r\n      const tools = [\r\n        'pen',\r\n        'mirror-pen',\r\n        'paint-bucket',\r\n        'same-color-pixel',\r\n        'eraser',\r\n        'stroke',\r\n        'circle',\r\n        'rectangle',\r\n        'move',\r\n        'lighten-darken',\r\n        'dither',\r\n        'color-picker',\r\n        'smooth-pen',\r\n      ];\r\n      return (\r\n        <ul \r\n          className=\"drawing-tools\"\r\n          onClick={this.handleClick}\r\n        >\r\n          {tools.map((tool, id) => \r\n            <li \r\n              className={tool + (tool === drawApi.selectedTool ? ' selected' : '')}\r\n              key={id}\r\n            ></li>\r\n          )}\r\n        </ul>\r\n      );\r\n    }\r\n\r\n    handleClick(e) {\r\n      if(e.target.className === 'drawing-tools') return;\r\n      drawApi.selectedTool = e.target.className;\r\n    }\r\n  }\r\n);\r\nexport default DrawingTools;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState } from '../../appState';\r\nimport drawApi from '../../drawApi';\r\n\r\nconst ColorSwitcher = observer(\r\n  class ColorSwitcher extends React.Component {\r\n    \r\n    render() {\r\n      return (\r\n        <div className=\"color-switcher\">\r\n          <label \r\n            className=\"primary-color\" \r\n            style={{ background: drawApi.primaryColor }}\r\n          >\r\n            <input\r\n              type=\"color\"\r\n              name=\"primary\"\r\n              id=\"primary\"\r\n              onInput={this.handleColor}\r\n            />\r\n          </label>\r\n          <label \r\n            className=\"secondary-color\"\r\n            style={{ background: drawApi.secondaryColor }}\r\n          >\r\n            <input \r\n              type=\"color\" \r\n              name=\"secondary\" \r\n              id=\"secondary\"\r\n              onInput={this.handleColor}\r\n            />\r\n          </label>\r\n          <button id='switch-colors' onClick={this.handleColorSwitch}></button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    handleColor(e) {\r\n      drawApi[`${e.currentTarget.id}Color`] = e.currentTarget.value;\r\n    }\r\n\r\n    handleColorSwitch() {\r\n      [ drawApi.primaryColor, drawApi.secondaryColor ] = [ drawApi.secondaryColor, drawApi.primaryColor ];\r\n    }\r\n  }\r\n);\r\n\r\nexport default ColorSwitcher;\r\n","import React from 'react';\nimport { PXSize, DrawingTools, ColorSwitcher } from './toolpad_comp/';\nimport { observer } from 'mobx-react';\nimport { appState } from '../appState';\n\nconst ToolPad = observer(\n  class ToolPad extends React.Component {\n    render() {\n      return (\n        <section className=\"tool-pad\">\n          <PXSize />\n          <DrawingTools />\n          <ColorSwitcher />\n          <button \n            className=\"key-bind-button\"\n            onClick={() => { appState.keyBindWindow = true }}\n          ></button>\n        </section>\n      );\n    }\n  }\n);\n\nexport default ToolPad;\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState, playerState } from '../../appState';\r\n\r\nconst Player = observer(\r\n  class Player extends React.Component {\r\n    render() {\r\n      return (\r\n        <div className=\"player\">\r\n          <div className=\"player-canvas-container\">\r\n            <canvas\r\n              className=\"player-canvas\"\r\n              width={appState.size}\r\n              height={appState.size}\r\n            >\r\n            </canvas>\r\n          </div>\r\n          <div className=\"player-controls\">\r\n            <button className=\"fullscreen\">&#9645;</button>\r\n            <div className=\"player-fps\">FPS{playerState.fps}</div>\r\n            <input\r\n              type=\"range\"\r\n              name=\"input-fps\"\r\n              id=\"input-fps\"\r\n              min={1}\r\n              max={24}\r\n              onInput={(e) => { playerState.fps = e.currentTarget.value; playerState.start() }}\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    componentDidMount() {\r\n      playerState.start();\r\n    }\r\n  }\r\n);\r\n\r\nexport default Player;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState } from '../../appState';\r\n// import { appState, frames } from '../../appState';\r\n\r\nconst LayersList = observer(\r\n  class LayersList extends React.Component {\r\n    render() {\r\n      return (\r\n        <div \r\n          className=\"layers-list\"\r\n          onClick={this.handleClick}\r\n        >\r\n          {new Array(appState.layers).fill(null).map((layer, id) => {\r\n            return (\r\n            <div \r\n              className={\"layer-\" + id + (appState.currentLayer === id ? ' selected' : '')}\r\n              data-layer={id}\r\n              key={Math.random()}           \r\n            >\r\n              layer {id}\r\n            </div>\r\n            );\r\n          }).reverse()        \r\n          }\r\n        </div>\r\n      );\r\n    }\r\n\r\n    handleClick(e) {\r\n      e = e.nativeEvent;\r\n      if (e.target === e.currentTarget) return;\r\n      appState.currentLayer = +e.target.dataset.layer; \r\n    }\r\n  }\r\n);\r\n\r\nexport default LayersList;\r\n","import React from 'react';\nimport { observer } from 'mobx-react';\n// import { appState } from '../../appState';\nimport { appState, frames } from '../../appState';\nimport LayersList from './LayersList';\n\nconst Layers = observer(\n  class Layers extends React.Component {\n    render() {\n      return (\n        <div className=\"layers\">\n          <div className='component-name'>\n            <div>Layers</div>\n            <button \n              className={\"show-all-layers\" + (appState.onionSkin ? \" checked\" : \"\")}\n              onClick={() => {appState.onionSkin = !appState.onionSkin}}            \n            >&#128065;</button>\n          </div>\n          <div className=\"layers-control\" onClick={this.handleClick}>\n            <button className=\"layer-add\">+</button>\n            <button className=\"layer-up\">&#129093;</button>\n            <button className=\"layer-down\">&#129095;</button>\n            <button className=\"layer-delete\">&#10005;</button>\n          </div>\n          <LayersList />\n        </div>\n      );\n    }\n\n    handleClick(e) {\n      switch (e.target.className) {\n        case 'layer-add':\n          appState.addLayer();\n          break;\n\n        case 'layer-delete':\n          appState.deleteCurrentLayer();\n          break;\n\n        case 'layer-up':\n          frames.moveLayer(true);\n          break;\n\n        case 'layer-down':\n          frames.moveLayer(false);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n);\n\nexport default Layers;\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState } from '../../appState';\r\n// import { appState, frames } from '../../appState';\r\n\r\nconst LayerComposition = observer(\r\n  class LayerComposition extends React.Component {\r\n    render() {\r\n      const operators = [\r\n        'source-over',\r\n        'source-in',\r\n        'source-out',\r\n        'source-atop',\r\n        'destination-over',\r\n        'destination-in',\r\n        'destination-out',\r\n        'destination-atop',\r\n        'lighter',\r\n        'copy',\r\n        'xor',\r\n        'multiply',\r\n        'screen',\r\n        'overlay',\r\n        'darken',\r\n        'lighten',\r\n        'color-dodge',\r\n        'color-burn',\r\n        'hard-light',\r\n        'soft-light',\r\n        'difference',\r\n        'exclusion',\r\n        'hue',\r\n        'saturation',\r\n        'color',\r\n        'luminosity'\r\n      ]\r\n      return (\r\n        <div className='select-container'>\r\n          <p>Composition style</p>\r\n          <select \r\n            name=\"composite-style\" \r\n            id=\"composite-style\"\r\n            onChange={this.handleInput}\r\n          >\r\n            {operators.map((operator, id) => \r\n              <option \r\n                value={operator}\r\n                key={id }\r\n              >{operator}</option>\r\n            )}\r\n          </select>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    handleInput(e) {\r\n      appState.compositeOperation = e.target.value;\r\n    }\r\n  }\r\n);\r\n\r\nexport default LayerComposition;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState, frames } from '../../appState';\r\nimport drawApi from '../../drawApi';\r\n\r\nconst Transform = observer(\r\n  class Transform extends React.Component {\r\n    render() {\r\n      return (\r\n        <div className='transform-container'>\r\n          <p>Transform</p>\r\n          <div\r\n            className=\"transform-buttons\"\r\n            onClick={this.handleClick}\r\n          >\r\n            <button className=\"vertical-mirror\"></button>\r\n            <button className=\"horisontal-mirror\"></button>\r\n            <button className=\"rotate\"></button>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    handleClick(e) {\r\n      switch (e.target.className) {\r\n        case \"vertical-mirror\":\r\n          drawApi.mirror(true);\r\n          break;\r\n\r\n        case \"horisontal-mirror\":\r\n          drawApi.mirror(false);\r\n          break;\r\n\r\n        case \"rotate\":\r\n          drawApi.rotate();\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  }\r\n);\r\n\r\nexport default Transform;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { appState, frames } from '../../appState';\r\n\r\nconst CanvasInfo = observer(\r\n  class CanvasInfo extends React.Component {\r\n    render() {\r\n      return (\r\n        <div \r\n          className=\"canvas-info\"\r\n        >\r\n          <p>Mouse position: <span>{appState.x} : {appState.y}</span></p>\r\n          <p>Canvas size: <span>{appState.size}x{appState.size}</span></p>\r\n          <p>Current layer: <span>{appState.currentLayer}</span></p>\r\n          <p>Current frame: <span>{appState.currentFrame + 1}</span></p>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n);\r\n\r\nexport default CanvasInfo;\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\n// import { appState, frames } from '../appState';\r\nimport { Player, Layers, LayerComposition, Transform, CanvasInfo } from './layerpad_comp/';\r\nimport './LayerPad.css';\r\n\r\nconst LayerPad = observer(\r\n  class LayerPad extends React.Component {\r\n    render() {\r\n      return (\r\n        <section className=\"layer-pad\">\r\n          <Player />\r\n          <Layers />\r\n          <LayerComposition />\r\n          <Transform />\r\n          <CanvasInfo />\r\n        </section>\r\n      );\r\n    }\r\n  }\r\n);\r\n\r\nexport default LayerPad;\r\n","import React from 'react';\r\nimport { appState } from '../appState';\r\nimport './Menu.css';\r\n// import drawApi from '../drawApi';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst Menu = observer(\r\n  class Menu extends React.Component {\r\n    render() {\r\n      return (\r\n        <section className=\"menu\">\r\n          <button\r\n            className=\"canvas-size\"\r\n            data-size={appState.size}\r\n            onClick={this.handleChangeSize}\r\n          >{appState.size}</button>\r\n          <button\r\n            className=\"export\"\r\n            onClick={this.handleExport}\r\n          ></button>\r\n        </section>\r\n      );\r\n    }\r\n\r\n\r\n    handleChangeSize(e) {\r\n      const size = +e.currentTarget.dataset.size;\r\n      if (size === 32) {\r\n        appState.scale /= 2;\r\n        appState.size = 64;\r\n      } else if (size === 64) {\r\n        appState.scale /= 2;\r\n        appState.size = 128;\r\n      } else {\r\n        appState.scale *= 4;\r\n        appState.size = 32;\r\n      }\r\n    }\r\n\r\n    handleExport(e) {\r\n      appState.exportWindow = true;\r\n    }\r\n  }\r\n);\r\n\r\nexport default Menu;\r\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { appState, encoder } from '../appState';\nimport './ExportWindow.css';\n\nconst ExportWindow = observer(\n  class ExportWindow extends React.Component {\n    render() {\n      return (\n        <div\n          className={\"export-window-overlay\" + (appState.exportWindow ? ' active' : '')}\n          onClick={this.handleClose}\n        >\n\n          <form\n            className=\"export-window\"\n            onSubmit={this.handleSubmit}\n          >\n            <legend>Export animation</legend>\n            <label htmlFor=\"export-name\">\n              File name:\n            <input\n                type=\"text\"\n                name=\"export-name\"\n                id=\"export-name\"\n                value={encoder.name}\n                onChange={this.handleNameChange}\n              />\n            </label>\n\n            <label htmlFor=\"export-format\">\n              Export format:\n            <select\n                name=\"export-format\"\n                id=\"export-format\"\n                onChange={this.handleFormatChange}\n              >\n                <option value=\"gif\">gif</option>\n                <option value=\"psk\">psk</option>\n                <option value=\"apng\">apng</option>\n              </select>\n            </label>\n\n            <label htmlFor=\"export-fps\">\n              FPS: {encoder.fps}\n              <input\n                type=\"range\"\n                name=\"export-fps\"\n                id=\"export-fps\"\n                min={1}\n                max={60}\n                value={encoder.fps}\n                onChange={this.handleFPSChange}\n              />\n            </label>\n\n            <label htmlFor=\"export-size\">\n              Size: {encoder.size}x{encoder.size}\n              <input\n                type=\"range\"\n                name=\"export-size\"\n                id=\"export-size\"\n                min={32}\n                max={1024}\n                step={32}\n                value={encoder.size}\n                onChange={this.handleSizeChange}\n              />\n            </label>\n\n            <label htmlFor=\"export-background-color\">\n              Background color:\n            <input\n                type=\"color\"\n                name=\"export-background-color\"\n                id=\"export-background-color\"\n                onInput={this.handleBackgroundColorChange}\n              />\n            </label>\n            <div\n              id=\"encoder-close\"\n              onClick={this.handleCloseWindow}\n            >X</div>\n            <button type=\"submit\" id='export-submit-button'>Export</button>\n          </form>\n        </div>\n      );\n    }\n\n    handleSubmit(e) {\n      e.preventDefault();\n      console.log('EXPORT');\n      appState.exportWindow = false;\n      switch (encoder.format) {\n        case \"gif\":\n          encoder.exportGif();\n          break;\n\n        case \"psk\":\n          encoder.exportPSK();\n          break;\n\n        case \"apng\":\n          encoder.exportAPNG();\n          break;\n        default:\n          break;\n      }\n    }\n\n    handleNameChange(e) {\n      encoder.name = e.target.value;\n    }\n\n    handleFormatChange(e) {\n      encoder.format = e.target.value;\n    }\n\n    handleFPSChange(e) {\n      encoder.fps = e.target.value;\n    }\n\n    handleSizeChange(e) {\n      encoder.size = e.target.value;\n    }\n\n    handleBackgroundColorChange(e) {\n      encoder.backgroundColor = e.target.value;\n    }\n\n    handleCloseWindow() {\n      appState.exportWindow = false;\n    }\n\n    handleClose(e) {\n      if (e.target.classList.contains('export-window-overlay')) {\n        appState.exportWindow = false;\n      }\n    }\n  }\n);\n\nexport default ExportWindow;\n","import FramePad from './FramePad';\r\n\r\nexport default FramePad;\r\n","import React from 'react';\nimport './FramePad.css';\nimport { observer } from 'mobx-react';\nimport { appState, frames } from '../../appState';\n\n\nconst FramePad = observer(\n  class FramePad extends React.Component {\n    render() {\n      console.log(`RENDER STARTED`, JSON.stringify(frames.data).slice(0, 0), appState.currentLayer);\n      return (\n        <section \n          className='frame-pad'\n\n        >\n          {frames.order.map(\n            (id, number) =>\n              <div\n                className={'frame' + (number === appState.currentFrame ? ' selected' : '')}\n                key={Math.random()}\n                id={id}\n                draggable={true}\n                onClick={this.handleFrameDiv}\n              >\n                <button className=\"delete-frame\"></button>\n                <button className=\"duplicate-frame\"></button>\n                <div className=\"number-frame\" data-idx={number}>{number + 1}</div>\n                <canvas\n                  width={appState.size}\n                  height={appState.size}\n                  ref={(canvas) => {this.handleCanvasRender(canvas, frames.data[id])}}\n                ></canvas>                \n              </div>\n          )}\n          <button\n            className='add-frame'\n            onClick={this.handleAddFrame}\n          >+</button>\n        </section>\n      );\n    }\n\n    componentDidMount() {\n      frames.addFrame(null);\n\n      const dropZone = document.querySelector('.frame-pad');\n      let startId;\n      \n      dropZone.ondragstart = (event) => {\n        startId = event.target.getAttribute('id');\n      };\n  \n      dropZone.ondragenter = (event) => {\n        if (event.target.parentElement.classList.contains('frame')) {\n          event.target.parentElement.classList.add('drag-hovered');\n        }\n      };\n  \n      dropZone.ondragleave = (event) => {\n        if (event.target.parentElement.classList.contains('frame')) {\n          event.target.parentElement.classList.remove('drag-hovered');\n        }\n      };\n  \n      dropZone.ondragover = e => e.preventDefault();\n  \n      dropZone.ondrop = (event) => {\n        const div = event.target.closest('[draggable]');\n        const targetId = div.getAttribute('id');\n  \n        event.preventDefault();\n        div.classList.remove('drag-hovered');\n\n        frames.switchFrames(startId, targetId);\n      };\n\n    }\n\n    handleCanvasRender(cnv, data) {\n      if(!cnv) return;\n      const ctx = cnv.getContext('2d');\n      ctx.clearRect(0, 0, cnv.width, cnv.height);\n      const curLayer = data[appState.currentLayer];\n      if(!curLayer) return;\n      ctx.putImageData(curLayer, 0, 0);\n    }\n\n    handleFrameDiv(e) {\n      const frame = e.currentTarget;\n      switch (e.target.className) {\n        case \"delete-frame\":\n          frames.deleteFrame(frame.id);\n          break;\n\n        case \"duplicate-frame\":\n          const data = frames.getData(frame.id)\n          const index = frames.order.indexOf(frame.id)\n          frames.addFrame(data, index + 1);\n          break;\n\n        default:\n          const div = frame.querySelector('.number-frame');\n          const value = +div.getAttribute('data-idx');\n          appState.currentFrame = value;\n          break;\n      }\n    }\n\n\n    handleAddFrame() {\n      frames.addFrame();\n    }\n  }\n);\n\nexport default FramePad;\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { GoogleLogout, GoogleLogin } from 'react-google-login';\r\nimport { appState } from '../appState';\r\n\r\nconst responseGoogle = (response) => {\r\n  console.log(response);\r\n}\r\n\r\nconst user = {\r\n  name: null,\r\n  surname: null,\r\n  imageUrl: null,\r\n}\r\n\r\nconst Login = observer(\r\n  class Login extends React.Component {\r\n    render() {\r\n      if (appState.logIn) {\r\n        return (\r\n          <div className=\"logged-on\">\r\n            <GoogleLogout\r\n              render={renderProps => (\r\n                <button\r\n                  onClick={renderProps.onClick}\r\n                  disabled={renderProps.disabled}\r\n                  className='logout-button'\r\n                >Log out</button>\r\n              )}\r\n              buttonText=\"Logout\"\r\n              onLogoutSuccess={() => { \r\n                appState.logIn = false \r\n                user.name = null;\r\n                user.surname = null;\r\n                user.imageUrl = null;\r\n              }}\r\n            >\r\n            </GoogleLogout>\r\n            <div className=\"user-info\">\r\n              <img \r\n                className='user-picture' \r\n                src={user.imageUrl} \r\n                alt=\"user avatar\"\r\n                width={30}\r\n                height={30}\r\n              />\r\n              <p className=\"user-name\">\r\n                {user.name}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        );\r\n      } else {\r\n        return (\r\n          <GoogleLogin\r\n            clientId=\"793758825150-kqjdqdoq5rivu22bcgtv30j2mbjn0csv.apps.googleusercontent.com\"\r\n            render={renderProps => (\r\n              <button\r\n                onClick={renderProps.onClick}\r\n                disabled={renderProps.disabled}\r\n                className='login-button'\r\n              >Sign up with Google</button>\r\n            )}\r\n            buttonText=\"Login\"\r\n            onSuccess={(resp) => {\r\n              responseGoogle(resp);\r\n              user.name = resp.profileObj.givenName;\r\n              user.surname = resp.profileObj.familyName;\r\n              user.imageUrl = resp.profileObj.imageUrl;\r\n              appState.logIn = true;\r\n            }}\r\n            onFailure={responseGoogle}\r\n            cookiePolicy={'single_host_origin'}\r\n          />\r\n        );\r\n      }\r\n    }\r\n  }\r\n);\r\n\r\nexport default Login;\r\n","import React from 'react';\r\nimport Login from './Login';\r\nimport './HeadPad.css';\r\n\r\nclass HeadPad extends React.Component {\r\n  render() {\r\n    return (\r\n      <header>\r\n        <h1>PiSKEL</h1>\r\n        <h2>{this.props.name}</h2>\r\n        <div className='header-buttons'>\r\n          <button className=\"create-sprite\">Create Sprite</button>\r\n          <Login />\r\n        </div>\r\n      </header>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HeadPad;\r\n","\nimport { observable } from 'mobx';\nimport { extendObservable } from 'mobx';\n\nclass KeyBind {\n  constructor() {\n    extendObservable(this, {\n      pen: 'KeyP',\n      mirrorPen: 'KeyA',\n      paintBucket: 'KeyS',\n      sameColorPixel: 'KeyD',\n      eraser: 'KeyF',\n      stroke: 'KeyG',\n      circle: 'KeyH',\n      rectangle: 'KeyJ',\n      move: 'KeyK',\n      lightenDarken: 'KeyR',\n      dither: 'KeyT',\n      colorPicker: 'KeyY',\n      smoothPen: 'KeyN',\n    });\n  }\n}\n\nconst keyBind = new KeyBind();\n\nexport default keyBind;\n","import React from 'react';\r\n// import CanvasPad from './screens/canvas/';\r\n// import { ToolPad, LayerPad, Menu } from './tools';\r\n// import FramePad from './components/frames.list';\r\n// import HeadPad from './components/HeadPad';\r\nimport { observer } from 'mobx-react';\r\nimport { appState } from './appState';\r\n\r\n\r\nconst Landing = observer(\r\n  class Landing extends React.Component {\r\n    render() {\r\n      return (\r\n        <>\r\n          <main className=\"landing-box\">\r\n            <div className=\"landing-screenshot\"></div>\r\n            <div className=\"landing-info\">\r\n              <h1 className=\"landing-h1\">PiSKEL clone</h1>\r\n              <p className=\"landing-p\">Perfect application for\r\n                creating and editing pixelated sprites</p>\r\n              <button\r\n                className=\"landing-button\"\r\n                onClick={() => { appState.landing = false }}\r\n              >Create your Sprite</button>\r\n            </div>\r\n          </main>\r\n        </>\r\n      );\r\n    }\r\n  }\r\n);\r\n\r\nexport default Landing;\r\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { appState, frames, encoder } from '../appState';\nimport { Player, Layers } from './layerpad_comp';\nimport keyBind from '../keyBind';\nimport './KeyBindWindow.css';\n\nconst KeyBindWindow = observer(\n  class KeyBindWindow extends React.Component {\n    render() {\n      const tools = [\n        'pen',\n        'mirrorPen',\n        'paintBucket',\n        'sameColorPixel',\n        'eraser',\n        'stroke',\n        'circle',\n        'rectangle',\n        'move',\n        'lightenDarken',\n        'dither',\n        'colorPicker',\n        'smoothPen',\n      ];\n      return (\n        <div\n          className={\"key-bind-overlay\" + (appState.keyBindWindow ? ' active' : '')}\n          onClick={this.handleClosingClick}\n        >\n          <div className=\"key-bind-window\">\n            <div \n              className=\"key-bind-container\"\n              onClick={this.handleBindClick}\n            >\n\n              {\n                tools.map((tool, id) =>\n                  <div\n                    data-key={keyBind[tool]}\n                    data-tool={tool}\n                    key={id}\n                  >\n                    <div className={tool + '-image'}></div>\n                    <p className={appState.activeBindKey.tool === tool ? 'active' : ''}\n                    >{keyBind[tool]}</p>\n                  </div>\n                )\n              }\n            </div>\n\n            <button\n              className=\"close-window\"\n              onClick={() => { appState.keyBindWindow = false }}\n            >X</button>\n          </div>\n        </div>\n      );\n    }\n\n    handleBindClick(e) {\n      const target = e.target.closest('[data-key]');\n      const tool = target.dataset.tool;\n      const oldKey = target.dataset.key;\n      appState.activeBindKey = { target: target, tool: tool, oldKey: oldKey };\n      \n      window.onkeypress = (e) => {\n        e.stopPropagation();\n        switch (e.code) {\n          case `Tab`:\n          case `CapsLock`:\n          case `Escape`:\n          case `ShiftLeft`:\n          case `ControlLeft`:\n          case `ShiftRight`:\n          case `ControlRight`:\n          case `Enter`:\n          case `Backspace`:\n          case `ScrollLock`:\n          case `Pause`:\n          case `Insert`:\n          case `Home`:\n          case `PageUp`:\n          case `PageDown`:\n          case `Delete`:\n          case `End`:\n          case `NumLock`:\n          case `NumpadEnter`:\n          case `MetaLeft`:\n          case `MetaRight`:\n          case `ContextMenu`:\n          case `AltLeft`:\n          case `AltRight`:\n            keyBind[appState.activeBindKey.tool] = oldKey;\n            break;\n\n          default:\n            const newKey = e.code;\n            for (let key in keyBind) {\n              if (keyBind[key] === newKey) keyBind[key] = '..';\n            }\n            keyBind[appState.activeBindKey.tool] = newKey;\n            break;\n        }\n        appState.activeBindKey = { target: null, tool: null, oldKey: null };\n        window.onkeypress = null;\n      }\n    }\n\n\n\n    handleChange(e) {\n      const value = 'Key' + e.target.value.toUpperCase();\n    }\n\n    handleClosingClick(e) {\n      if (e.target.classList.contains('key-bind-overlay')) {\n        appState.keyBindWindow = false;\n        window.onkeypress = null;\n      }\n    }\n\n\n  }\n);\n\nexport default KeyBindWindow;\n","import React from 'react';\nimport CanvasPad from './screens/canvas/';\nimport { ToolPad, LayerPad, Menu, ExportWindow } from './tools';\nimport FramePad from './components/frames.list';\nimport HeadPad from './components/HeadPad';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { appState, frames } from './appState';\nimport keyBind from './keyBind';\nimport drawApi from './drawApi';\nimport Landing from './Landing';\nimport KeyBindWindow from './tools/KeyBindWindow';\n\nfunction unload2() {\n  const appStr = toJS(appState);\n\n  const framesStr = toJS(frames);\n\n  const keyBindStr = toJS(keyBind);\n\n  localStorage.setItem('appState', JSON.stringify(appStr));\n  localStorage.setItem('frames', JSON.stringify(framesStr));\n  localStorage.setItem('keyBind', JSON.stringify(keyBindStr));\n}\n\nconst App = observer(\n  class App extends React.Component {\n    render() {\n      if (appState.landing) {\n        return (\n          <>\n            <Landing />\n          </>\n        );\n      } else {\n        return (\n          <>\n            <HeadPad name='New Piskel *' />\n            <main>\n              <ToolPad />\n              <FramePad />\n              <CanvasPad />\n              <LayerPad />\n              <Menu />\n            </main>\n            <ExportWindow />\n            <KeyBindWindow />\n          </>\n        );\n      }\n\n    }\n\n    componentDidMount() {\n      window.addEventListener('keypress', this.keySwitcher);\n\n      // if (localStorage.getItem('appState')) {\n      //   const appStr = JSON.parse(localStorage.getItem('appState'));\n      //   const framesStr = JSON.parse(localStorage.getItem('frames'));\n      //   const keyBindStr = JSON.parse(localStorage.getItem('keyBind'));\n      //   for (let prop in appStr) {\n      //     appState[prop] = appStr[prop];\n      //   }\n\n      //   const data = framesStr.data;\n        \n      //   for (let frame in data) {\n          \n      //     const curframe = data[frame];\n          \n      //     for(let i = 0; i < curframe.length; i++) {\n      //       if(!curframe[i]) continue;\n      //       const imgdata = new ImageData(curframe[i].data, appState.size, appState.size);\n      //       curframe[i] = imgdata;\n      //     }\n      //   }\n        \n      //   console.log(framesStr.data);\n\n      //   for (let prop in framesStr) {\n      //     frames[prop] = framesStr[prop];\n      //   }\n\n      //   for (let prop in keyBindStr) {\n      //     keyBind[prop] = keyBindStr[prop];\n      //   }\n      // }\n\n      // window.onunload = unload2;\n    }\n\n    // componentWillUnmount() {\n    //   unload2();\n    // }\n\n    keySwitcher(e) {\n      console.log(keyBind.pen);\n      switch (e.code) {\n        case keyBind.pen:\n          drawApi.selectedTool = 'pen';\n          break;\n        case 'KeyO':\n          drawApi.selectedTool = 'mirror-pen';\n          break;\n\n        case 'KeyE':\n          drawApi.selectedTool = 'eraser';\n          break;\n\n        case 'KeyB':\n          drawApi.selectedTool = 'paint-bucket';\n          break;\n\n        case 'KeyU':\n          drawApi.selectedTool = 'color-picker';\n          break;\n\n        case 'KeyN':\n          drawApi.selectedTool = 'same-color-pixel';\n          break;\n\n        case 'KeyS':\n          drawApi.selectedTool = 'stroke';\n          break;\n\n        case 'KeyC':\n          drawApi.selectedTool = 'circle';\n          break;\n\n        case 'KeyR':\n          drawApi.selectedTool = 'rectangle';\n          break;\n\n        case 'KeyM':\n          drawApi.selectedTool = 'move';\n          break;\n\n        case 'KeyD':\n          drawApi.selectedTool = 'dither';\n          break;\n\n        case 'KeyL':\n          drawApi.selectedTool = 'lighten-darken';\n          break;\n\n        case 'KeyI':\n          drawApi.selectedTool = 'smooth-pen';\n          break;\n\n        default:\n          break;\n      }\n    }\n  }\n);\n\nexport default App;\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport './App.css';\nimport './fonts/fontello.css';\nimport './tools/ToolPad.css';\nimport { appState, frames } from './appState';\nimport keyBind from './keyBind';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}